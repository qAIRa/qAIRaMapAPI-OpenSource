version: "3"

services:
  test_database:
    image: postgres
    environment:
      - POSTGRES_DB=postgres
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=postgres

  test:
    build:
      context: ../..
      dockerfile: .docker/test/Dockerfile
    command: |
      bash -c "coverage run -m pytest project/test/ && coveralls"
    volumes:
      - ../..:/src/
    depends_on:
      - test_database
